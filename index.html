# ğŸ¬ ê°„ë‹¨í•˜ì§€ë§Œ ê°•ë ¥í•œ YouTube ìë™í™” ì‹œìŠ¤í…œ
# ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ í•µì‹¬ ë²„ì „

import os
import asyncio
import json
import logging
from datetime import datetime
from typing import Dict, List, Optional
from dataclasses import dataclass

# í™˜ê²½ ì„¤ì •
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(message)s')
logger = logging.getLogger(__name__)

@dataclass
class SimpleVideoProject:
    """ê°„ë‹¨í•œ ë¹„ë””ì˜¤ í”„ë¡œì íŠ¸"""
    title: str
    description: str
    tags: List[str]
    script: str = ""
    created_at: datetime = None
    
    def __post_init__(self):
        if self.created_at is None:
            self.created_at = datetime.now()

class SimpleYouTubeAutomation:
    """ê°„ë‹¨í•œ YouTube ìë™í™” ì‹œìŠ¤í…œ"""
    
    def __init__(self, openai_key: str = None):
        self.openai_key = openai_key or os.getenv('OPENAI_API_KEY')
        self.projects = []
        
        # ê¸°ë³¸ ì„¤ì •
        self.settings = {
            'default_duration': 5,
            'default_audience': 'ì¼ë°˜',
            'auto_save': True
        }
        
        # ë””ë ‰í† ë¦¬ ìƒì„±
        os.makedirs('simple_projects', exist_ok=True)
        
        print("ğŸ¬ ê°„ë‹¨ YouTube ìë™í™” ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ!")
    
    async def create_quick_project(self, topic: str, custom_title: str = None) -> SimpleVideoProject:
        """ë¹ ë¥¸ í”„ë¡œì íŠ¸ ìƒì„± (GPT ì—†ì´ë„ ì‘ë™)"""
        
        print(f"ğŸ“¹ '{topic}' í”„ë¡œì íŠ¸ ìƒì„± ì¤‘...")
        
        # 1. ì œëª© ìƒì„±
        if custom_title:
            title = custom_title
        else:
            title_templates = [
                f"{topic}ì— ëŒ€í•œ ì™„ë²½ ê°€ì´ë“œ",
                f"{topic} ì´ˆë³´ìë¥¼ ìœ„í•œ í•„ìˆ˜ ì •ë³´",
                f"{topic} ì „ë¬¸ê°€ê°€ ì•Œë ¤ì£¼ëŠ” ë¹„ë°€",
                f"{topic}ë¡œ ì„±ê³µí•˜ëŠ” í™•ì‹¤í•œ ë°©ë²•",
                f"{topic} ì™„ì „ ì •ë³µí•˜ê¸°"
            ]
            import random
            title = random.choice(title_templates)
        
        # 2. ì„¤ëª… ìƒì„±
        description = self._generate_description(topic, title)
        
        # 3. íƒœê·¸ ìƒì„±
        tags = self._generate_tags(topic)
        
        # 4. ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
        script = self._generate_script(title, topic)
        
        # 5. í”„ë¡œì íŠ¸ ìƒì„±
        project = SimpleVideoProject(
            title=title,
            description=description,
            tags=tags,
            script=script
        )
        
        # 6. ì €ì¥
        if self.settings['auto_save']:
            self._save_project(project)
        
        self.projects.append(project)
        
        print(f"âœ… í”„ë¡œì íŠ¸ ìƒì„± ì™„ë£Œ: {title}")
        return project
    
    def _generate_description(self, topic: str, title: str) -> str:
        """ì„¤ëª… ìë™ ìƒì„±"""
        
        description_parts = [
            f"ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ {topic}ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.",
            "",
            f"ğŸ¯ ì´ ì˜ìƒì—ì„œ ë°°ìš¸ ìˆ˜ ìˆëŠ” ê²ƒ:",
            f"âœ… {topic}ì˜ í•µì‹¬ ê°œë…",
            f"âœ… ì‹¤ì œ í™œìš© ë°©ë²•", 
            f"âœ… ì „ë¬¸ê°€ íŒê³¼ ë…¸í•˜ìš°",
            f"âœ… ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ë“¤",
            "",
            "ğŸ“‹ íƒ€ì„ìŠ¤íƒ¬í”„:",
            "00:00 ì¸íŠ¸ë¡œ",
            "00:30 í•µì‹¬ ë‚´ìš©",
            "04:00 ì‹¤ìŠµ ë° ì˜ˆì‹œ",
            "04:30 ë§ˆë¬´ë¦¬",
            "",
            "ğŸ‘ ì´ ì˜ìƒì´ ë„ì›€ë˜ì…¨ë‹¤ë©´ ì¢‹ì•„ìš”ì™€ êµ¬ë… ë¶€íƒë“œë¦½ë‹ˆë‹¤!",
            "ğŸ”” ì•Œë¦¼ ì„¤ì •ì„ ì¼œì„œ ìƒˆë¡œìš´ ì˜ìƒì„ ê°€ì¥ ë¨¼ì € ë°›ì•„ë³´ì„¸ìš”!",
            "ğŸ’¬ ê¶ê¸ˆí•œ ì ì´ë‚˜ ì˜ê²¬ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”!",
            "",
            f"#{topic.replace(' ', '')} #ìœ íŠœë¸Œ #ì •ë³´ #ê°€ì´ë“œ #íŒ",
            "",
            "ğŸ“§ ë¬¸ì˜: contact@example.com"
        ]
        
        return "\n".join(description_parts)
    
    def _generate_tags(self, topic: str) -> List[str]:
        """íƒœê·¸ ìë™ ìƒì„±"""
        
        # ê¸°ë³¸ íƒœê·¸
        basic_tags = [topic, 'ìœ íŠœë¸Œ', 'ê°€ì´ë“œ', 'ì •ë³´', 'íŒ', 'ë°©ë²•']
        
        # ì£¼ì œë³„ ì¶”ê°€ íƒœê·¸
        topic_tags = {
            'AI': ['ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ìë™í™”', 'ê¸°ìˆ '],
            'íˆ¬ì': ['ì¬í…Œí¬', 'ê²½ì œ', 'ì£¼ì‹', 'ë¶€ë™ì‚°', 'ê¸ˆìœµ'],
            'ìœ íŠœë¸Œ': ['í¬ë¦¬ì—ì´í„°', 'ë§ˆì¼€íŒ…', 'ì½˜í…ì¸ ', 'ì¡°íšŒìˆ˜'],
            'ìš”ë¦¬': ['ë ˆì‹œí”¼', 'ìŒì‹', 'ë§›ì§‘', 'ê±´ê°•'],
            'ìš´ë™': ['í—¬ìŠ¤', 'ë‹¤ì´ì–´íŠ¸', 'ê±´ê°•', 'í”¼íŠ¸ë‹ˆìŠ¤'],
            'ê°œë°œ': ['í”„ë¡œê·¸ë˜ë°', 'IT', 'ì½”ë”©', 'ê¸°ìˆ '],
            'ë¶€ë™ì‚°': ['íˆ¬ì', 'ê²½ì œ', 'ì¬í…Œí¬', 'ê¸ˆìœµ']
        }
        
        # ì£¼ì œ ê´€ë ¨ íƒœê·¸ ì¶”ê°€
        for key, values in topic_tags.items():
            if key.lower() in topic.lower():
                basic_tags.extend(values)
                break
        
        # ì¼ë°˜ì ì¸ ì¸ê¸° íƒœê·¸ ì¶”ê°€
        popular_tags = ['2024', 'ìµœì‹ ', 'ì™„ë²½', 'ì´ˆë³´ì', 'ì „ë¬¸ê°€', 'ê¿€íŒ']
        basic_tags.extend(popular_tags)
        
        # ì¤‘ë³µ ì œê±° ë° ìµœëŒ€ 15ê°œ ì œí•œ
        unique_tags = list(dict.fromkeys(basic_tags))
        return unique_tags[:15]
    
    def _generate_script(self, title: str, topic: str) -> str:
        """ìŠ¤í¬ë¦½íŠ¸ ìë™ ìƒì„±"""
        
        script_template = f"""
[0:00] ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ "{title}"ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ë³´ê² ìŠµë‹ˆë‹¤.

[0:15] ì´ ì˜ìƒì„ ëê¹Œì§€ ë³´ì‹œë©´ {topic}ì— ëŒ€í•´ í™•ì‹¤íˆ ì´í•´í•˜ì‹¤ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”.

[0:30] ê·¸ëŸ¼ ë°”ë¡œ ì‹œì‘í•´ë³¼ê¹Œìš”?

=== ë©”ì¸ ì½˜í…ì¸  ===

[1:00] ì²« ë²ˆì§¸ë¡œ ì•Œì•„ë³¼ ë‚´ìš©ì€ {topic}ì˜ ê¸°ë³¸ ê°œë…ì…ë‹ˆë‹¤.

[1:30] {topic}ë¥¼ ì²˜ìŒ ì ‘í•˜ì‹œëŠ” ë¶„ë“¤ì„ ìœ„í•´ ì‰½ê²Œ ì„¤ëª…ë“œë¦´ê²Œìš”.

[2:00] ë§ì€ ë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œëŠ” ë¶€ë¶„ì´ ë°”ë¡œ ì´ê²ƒì¸ë°ìš”...

[2:30] ì‹¤ì œë¡œ ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

[3:00] ì—¬ê¸°ì„œ ì¤‘ìš”í•œ í¬ì¸íŠ¸ëŠ”...

[3:30] ì´ˆë³´ìë“¤ì´ ìì£¼ ì‹¤ìˆ˜í•˜ëŠ” ë¶€ë¶„ë„ í•¨ê»˜ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

[4:00] ì§€ê¸ˆê¹Œì§€ {topic}ì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ëŠ”ë°ìš”.

[4:15] ì˜¤ëŠ˜ ë‚´ìš©ì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ì¢‹ì•„ìš”ì™€ êµ¬ë… ë¶€íƒë“œë¦½ë‹ˆë‹¤!

[4:30] ë‹¤ìŒ ì˜ìƒì—ì„œ ë” ìœ ìš©í•œ ë‚´ìš©ìœ¼ë¡œ ì°¾ì•„ëµ™ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤!

=== ì¶”ê°€ íŒ ===
â€¢ ì‹œì²­ìì™€ì˜ ì†Œí†µ: "ì—¬ëŸ¬ë¶„ì€ ì–´ë–»ê²Œ ìƒê°í•˜ì‹œë‚˜ìš”?"
â€¢ ì°¸ì—¬ ìœ ë„: "ëŒ“ê¸€ë¡œ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”!"
â€¢ êµ¬ë… ìœ ë„: "êµ¬ë…ê³¼ ì•Œë¦¼ ì„¤ì • ìŠì§€ ë§ˆì„¸ìš”!"
"""
        
        return script_template.strip()
    
    def _save_project(self, project: SimpleVideoProject):
        """í”„ë¡œì íŠ¸ ì €ì¥"""
        
        # ì•ˆì „í•œ íŒŒì¼ëª… ìƒì„±
        safe_title = "".join(c for c in project.title if c.isalnum() or c in (' ', '-', '_')).strip()[:30]
        timestamp = project.created_at.strftime('%Y%m%d_%H%M%S')
        filename = f"simple_projects/{timestamp}_{safe_title}.json"
        
        # í”„ë¡œì íŠ¸ ë°ì´í„°
        project_data = {
            'title': project.title,
            'description': project.description,
            'tags': project.tags,
            'script': project.script,
            'created_at': project.created_at.isoformat(),
            'settings_used': self.settings.copy()
        }
        
        # JSON íŒŒì¼ë¡œ ì €ì¥
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(project_data, f, ensure_ascii=False, indent=2)
        
        # ìŠ¤í¬ë¦½íŠ¸ ë³„ë„ ì €ì¥
        script_filename = filename.replace('.json', '_script.txt')
        with open(script_filename, 'w', encoding='utf-8') as f:
            f.write(project.script)
        
        logger.info(f"ğŸ“ í”„ë¡œì íŠ¸ ì €ì¥: {filename}")
    
    async def bulk_create(self, topics: List[str]) -> List[SimpleVideoProject]:
        """ëŒ€ëŸ‰ í”„ë¡œì íŠ¸ ìƒì„±"""
        
        print(f"ğŸš€ {len(topics)}ê°œ ì£¼ì œë¡œ ëŒ€ëŸ‰ ìƒì„± ì‹œì‘!")
        
        projects = []
        for i, topic in enumerate(topics, 1):
            print(f"\n[{i}/{len(topics)}] ì²˜ë¦¬ ì¤‘: {topic}")
            
            try:
                project = await self.create_quick_project(topic)
                projects.append(project)
                print(f"âœ… ì™„ë£Œ: {project.title}")
                
                # ë„ˆë¬´ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•˜ì§€ ì•Šë„ë¡ ì ì‹œ ëŒ€ê¸°
                await asyncio.sleep(0.5)
                
            except Exception as e:
                print(f"âŒ ì‹¤íŒ¨: {topic} - {e}")
        
        print(f"\nğŸ‰ ëŒ€ëŸ‰ ìƒì„± ì™„ë£Œ! ì´ {len(projects)}ê°œ í”„ë¡œì íŠ¸")
        return projects
    
    def get_project_summary(self) -> Dict:
        """í”„ë¡œì íŠ¸ ìš”ì•½"""
        
        if not self.projects:
            return {'message': 'ìƒì„±ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.'}
        
        return {
            'total_projects': len(self.projects),
            'recent_projects': [
                {
                    'title': p.title,
                    'tags_count': len(p.tags),
                    'script_length': len(p.script),
                    'created_at': p.created_at.strftime('%Y-%m-%d %H:%M')
                }
                for p in self.projects[-5:]  # ìµœê·¼ 5ê°œ
            ],
            'total_tags': sum(len(p.tags) for p in self.projects),
            'avg_script_length': sum(len(p.script) for p in self.projects) // len(self.projects)
        }
    
    def print_project_details(self, project: SimpleVideoProject):
        """í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´ ì¶œë ¥"""
        
        print("\n" + "="*60)
        print("ğŸ“‹ í”„ë¡œì íŠ¸ ìƒì„¸ ì •ë³´")
        print("="*60)
        print(f"ğŸ“¹ ì œëª©: {project.title}")
        print(f"ğŸ·ï¸ íƒœê·¸: {', '.join(project.tags[:8])}{'...' if len(project.tags) > 8 else ''}")
        print(f"ğŸ“ ì„¤ëª… ê¸¸ì´: {len(project.description)}ì")
        print(f"ğŸ“œ ìŠ¤í¬ë¦½íŠ¸ ê¸¸ì´: {len(project.script)}ì") 
        print(f"ğŸ“… ìƒì„± ì‹œê°„: {project.created_at.strftime('%Y-%m-%d %H:%M:%S')}")
        print(f"ğŸ’¾ ì €ì¥ë¨: simple_projects/ í´ë”")

# GPT ì—°ë™ ê¸°ëŠ¥ (ì„ íƒì )
class GPTEnhancer:
    """GPTë¡œ ì½˜í…ì¸  í’ˆì§ˆ í–¥ìƒ (ì„ íƒ ì‚¬í•­)"""
    
    def __init__(self, api_key: str):
        self.api_key = api_key
        try:
            import openai
            self.client = openai.OpenAI(api_key=api_key)
            self.available = True
        except ImportError:
            print("âš ï¸ OpenAI íŒ¨í‚¤ì§€ê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìƒì„± ëª¨ë“œë¡œ ì‘ë™í•©ë‹ˆë‹¤.")
            self.available = False
    
    async def enhance_title(self, topic: str) -> str:
        """ì œëª© ê°œì„ """
        if not self.available:
            return f"{topic}ì— ëŒ€í•œ ì™„ë²½ ê°€ì´ë“œ"
        
        try:
            response = await self.client.chat.completions.acreate(
                model="gpt-3.5-turbo",
                messages=[
                    {"role": "user", "content": f"'{topic}' ì£¼ì œë¡œ í´ë¦­ë¥ ì´ ë†’ì€ ìœ íŠœë¸Œ ì œëª© 1ê°œë¥¼ 50ì ì´ë‚´ë¡œ ë§Œë“¤ì–´ì£¼ì„¸ìš”."}
                ],
                max_tokens=100
            )
            return response.choices[0].message.content.strip()
        except:
            return f"{topic} - ì „ë¬¸ê°€ê°€ ì•Œë ¤ì£¼ëŠ” ë¹„ë°€"

# ì‚¬ìš© ì˜ˆì‹œ ë° ì‹¤í–‰ í•¨ìˆ˜
async def demo_simple_automation():
    """ê°„ë‹¨í•œ ìë™í™” ì‹œìŠ¤í…œ ë°ëª¨"""
    
    print("ğŸ¬ ê°„ë‹¨ YouTube ìë™í™” ì‹œìŠ¤í…œ ë°ëª¨")
    print("="*50)
    
    # ì‹œìŠ¤í…œ ì´ˆê¸°í™”
    automation = SimpleYouTubeAutomation()
    
    # 1. ë‹¨ì¼ í”„ë¡œì íŠ¸ ìƒì„±
    print("\n1ï¸âƒ£ ë‹¨ì¼ í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸")
    project1 = await automation.create_quick_project("AI íˆ¬ì ì „ëµ")
    automation.print_project_details(project1)
    
    # 2. ì‚¬ìš©ì ì •ì˜ ì œëª©ìœ¼ë¡œ ìƒì„±
    print("\n2ï¸âƒ£ ì‚¬ìš©ì ì •ì˜ ì œëª© í”„ë¡œì íŠ¸")
    project2 = await automation.create_quick_project(
        topic="ë¶€ë™ì‚° íˆ¬ì", 
        custom_title="2024ë…„ ë¶€ë™ì‚° íˆ¬ì ëŒ€ë°•ë‚˜ëŠ” 3ê°€ì§€ ë¹„ë²•"
    )
    automation.print_project_details(project2)
    
    # 3. ëŒ€ëŸ‰ ìƒì„±
    print("\n3ï¸âƒ£ ëŒ€ëŸ‰ í”„ë¡œì íŠ¸ ìƒì„± í…ŒìŠ¤íŠ¸")
    topics = ["ìœ íŠœë¸Œ ë§ˆì¼€íŒ…", "ì£¼ì‹ íˆ¬ì", "íŒŒì´ì¬ í”„ë¡œê·¸ë˜ë°", "ì˜ì–´ íšŒí™”"]
    bulk_projects = await automation.bulk_create(topics)
    
    # 4. ìš”ì•½ ì •ë³´
    print("\n4ï¸âƒ£ ì „ì²´ í”„ë¡œì íŠ¸ ìš”ì•½")
    summary = automation.get_project_summary()
    print(json.dumps(summary, ensure_ascii=False, indent=2))
    
    print(f"\nğŸ‰ ë°ëª¨ ì™„ë£Œ! ì´ {len(automation.projects)}ê°œ í”„ë¡œì íŠ¸ ìƒì„±ë¨")
    print(f"ğŸ“ íŒŒì¼ ìœ„ì¹˜: simple_projects/ í´ë” í™•ì¸")

# ëŒ€í™”í˜• ì‹¤í–‰ í•¨ìˆ˜
async def interactive_mode():
    """ëŒ€í™”í˜• ëª¨ë“œ"""
    
    print("ğŸ¬ ëŒ€í™”í˜• YouTube í”„ë¡œì íŠ¸ ìƒì„±ê¸°")
    print("="*50)
    
    automation = SimpleYouTubeAutomation()
    
    while True:
        print("\nğŸ“‹ ë©”ë‰´:")
        print("1. ë‹¨ì¼ í”„ë¡œì íŠ¸ ìƒì„±")
        print("2. ëŒ€ëŸ‰ í”„ë¡œì íŠ¸ ìƒì„±") 
        print("3. í”„ë¡œì íŠ¸ ìš”ì•½ ë³´ê¸°")
        print("4. ì¢…ë£Œ")
        
        choice = input("\nì„ íƒ (1-4): ").strip()
        
        try:
            if choice == "1":
                topic = input("ğŸ“ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”: ").strip()
                if topic:
                    custom_title = input("âœï¸ ì‚¬ìš©ì ì •ì˜ ì œëª© (ì—”í„°ë¡œ ê±´ë„ˆë›°ê¸°): ").strip()
                    project = await automation.create_quick_project(
                        topic, 
                        custom_title if custom_title else None
                    )
                    automation.print_project_details(project)
                
            elif choice == "2":
                topics_input = input("ğŸ“ ì£¼ì œë“¤ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•´ì„œ ì…ë ¥í•˜ì„¸ìš”: ").strip()
                if topics_input:
                    topics = [t.strip() for t in topics_input.split(',') if t.strip()]
                    await automation.bulk_create(topics)
                
            elif choice == "3":
                summary = automation.get_project_summary()
                print(json.dumps(summary, ensure_ascii=False, indent=2))
                
            elif choice == "4":
                print("ğŸ‘‹ ì‹œìŠ¤í…œì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
                break
                
            else:
                print("âŒ ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.")
                
        except KeyboardInterrupt:
            print("\nğŸ‘‹ ì‹œìŠ¤í…œì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break
        except Exception as e:
            print(f"âŒ ì˜¤ë¥˜: {e}")

# ë©”ì¸ ì‹¤í–‰
if __name__ == "__main__":
    print("ğŸš€ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ YouTube ìë™í™” ì‹œìŠ¤í…œ")
    print("="*60)
    print("ì„ íƒí•˜ì„¸ìš”:")
    print("1. ë°ëª¨ ì‹¤í–‰")
    print("2. ëŒ€í™”í˜• ëª¨ë“œ")
    
    choice = input("\nì„ íƒ (1-2): ").strip()
    
    try:
        if choice == "1":
            asyncio.run(demo_simple_automation())
        elif choice == "2":
            asyncio.run(interactive_mode())
        else:
            print("âŒ ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.")
    except KeyboardInterrupt:
        print("\nğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
