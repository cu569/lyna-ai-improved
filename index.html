from flask import Flask, render_template, request, jsonify
from selenium import webdriver
from selenium.webdriver.common.by import By
import time, os, sys

app = Flask(__name__)

# 1) 업로드할 동영상이 있는 폴더 (영문 경로 권장)
VIDEO_DIR = r'C:\video\bulk'  
if not os.path.isdir(VIDEO_DIR):
    print(f"ERROR: 디렉터리가 없습니다: {VIDEO_DIR}")
    sys.exit(1)

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/run-batch-upload', methods=['POST'])
def run_batch_upload():
    files = [f for f in os.listdir(VIDEO_DIR) if f.lower().endswith('.mp4')]
    if len(files) == 0:
        return jsonify(ok=False, error="업로드할 .mp4 파일이 없습니다.")

    try:
        driver = webdriver.Chrome()
        driver.get('https://studio.youtube.com/')
        input("▶ 로그인 완료 후 Enter 눌러주세요…")

        results = []
        for idx, fname in enumerate(files, start=1):
            path = os.path.join(VIDEO_DIR, fname)
            try:
                # --- 업로드 루틴 ---
                driver.find_element(By.XPATH, '//*[@id="create-icon"]').click()
                time.sleep(1)
                driver.find_element(By.XPATH, '//*[@id="text-item-0"]').click()
                time.sleep(2)
                driver.find_element(By.XPATH, '//input[@type="file"]').send_keys(path)
                # (원한다면 제목/설명 자동 입력 코드를 여기에 추가)
                time.sleep(8)  # 업로드 시작 대기
                # 다음 버튼 클릭 등 추가 자동화 가능
                time.sleep(60)  # 완전 업로드 대기

                results.append({ 'file': fname, 'status': 'ok' })
                print(f"[{idx}/{len(files)}] 업로드 성공: {fname}")
            except Exception as e:
                results.append({ 'file': fname, 'status': 'error', 'msg': str(e) })
                print(f"[{idx}/{len(files)}] 업로드 실패: {fname} → {e}")
                # 실패해도 계속 진행

        driver.quit()
        return jsonify(ok=True, total=len(files), results=results)

    except Exception as e:
        return jsonify(ok=False, error=str(e))

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>Batch YouTube Upload</title>
  <style>
    /* 간략화된 스타일 */
    body{font-family:sans-serif;padding:2em;}
    button{padding:1em;border:none;background:#4b4bff;color:white;border-radius:6px;cursor:pointer;}
    pre{background:#f0f0f0;padding:1em;}
  </style>
</head>
<body>
  <h1>대량(30k) 유튜브 업로드</h1>
  <p>▶ 업로드 폴더: <code>C:\video\bulk</code></p>
  <button onclick="batchUpload()">대량 업로드 시작</button>

  <h2>진행 로그</h2>
  <pre id="log"></pre>

  <script>
    function log(txt){
      document.getElementById('log').innerText += txt + "\n";
    }

    function batchUpload(){
      log("▶ 업로드 폴더 스캔 중...");
      fetch('/run-batch-upload', { method:'POST' })
        .then(r=>r.json()).then(j=>{
          if(!j.ok){
            log("ERROR: " + j.error);
            return;
          }
          log(`총 ${j.total}개 파일 처리 완료.`);
          j.results.forEach((res,i)=>{
            log(`${i+1}. ${res.file} → ${res.status}` + (res.msg?(" ("+res.msg+")"):""));
          });
        });
    }
  </script>
</body>
</html>
