# YouTube 자동 업로드 - 텍스트만
import time
import os
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options

def setup():
    options = Options()
    options.add_argument("--headless")  # 브라우저 화면 숨김
    options.add_argument("--no-sandbox")
    options.add_argument("--disable-dev-shm-usage")
    driver = webdriver.Chrome(options=options)
    return driver, WebDriverWait(driver, 30)

def upload(video_file, title, description=""):
    print("시작...")
    
    driver, wait = setup()
    
    print("YouTube 접속...")
    driver.get("https://studio.youtube.com/")
    
    print("로그인 필요 - 브라우저 열기...")
    # 로그인을 위해 잠깐 화면 표시
    driver.execute_script("window.open('https://accounts.google.com/signin');")
    input("로그인 완료 후 엔터: ")
    
    print("업로드 시작...")
    
    # 업로드
    wait.until(EC.element_to_be_clickable((By.XPATH, "//ytcp-button[@id='create-icon']"))).click()
    wait.until(EC.element_to_be_clickable((By.XPATH, "//tp-yt-paper-item[@test-id='upload-video']"))).click()
    
    print("파일 선택...")
    file_input = wait.until(EC.presence_of_element_located((By.XPATH, "//input[@type='file']")))
    file_input.send_keys(os.path.abspath(video_file))
    
    print("제목 입력...")
    time.sleep(3)
    title_field = wait.until(EC.element_to_be_clickable((By.XPATH, "//div[@id='textbox']")))
    title_field.clear()
    title_field.send_keys(title)
    
    if description:
        print("설명 입력...")
        try:
            desc_field = driver.find_element(By.XPATH, "(//div[@id='textbox'])[2]")
            desc_field.send_keys(description)
        except:
            pass
    
    print("설정 진행...")
    for i in range(3):
        try:
            wait.until(EC.element_to_be_clickable((By.XPATH, "//ytcp-button[@id='next-button']"))).click()
            time.sleep(2)
            print(f"단계 {i+1}/3")
        except:
            pass
    
    print("게시 중...")
    wait.until(EC.element_to_be_clickable((By.XPATH, "//ytcp-button[@id='done-button']"))).click()
    
    print("완료 대기...")
    time.sleep(10)
    
    driver.quit()
    print("업로드 완료!")

# 실행
VIDEO = "test.mp4"
TITLE = "자동 업로드"
DESC = "자동 업로드 영상"

if os.path.exists(VIDEO):
    upload(VIDEO, TITLE, DESC)
else:
    print(f"파일 없음: {VIDEO}")

print("프로그램 종료")
