import time
import datetime
from upload import upload_video  # 실제 업로드 함수

def check_and_upload(queue_file="upload_queue.txt"):
    while True:
        with open(queue_file, "r", encoding="utf-8") as f:
            lines = f.readlines()

        new_lines = []
        for line in lines:
            path, upload_time_str = line.strip().split(',')
            upload_time = datetime.datetime.strptime(upload_time_str, "%Y-%m-%d %H:%M")

            if datetime.datetime.now() >= upload_time:
                print(f"Uploading: {path}")
                upload_video(path)
            else:
                new_lines.append(line)

        with open(queue_file, "w", encoding="utf-8") as f:
            f.writelines(new_lines)

        time.sleep(60)  # 1분마다 확인
