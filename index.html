<!-- 리마 생성 버튼/개인화, 맞춤형 대화/기억형 -->
<body>
  <div class="mainbox">
    <div class="title">G911 리마 1:1 퍼스널 비서</div>
    <div style="text-align:right">
      <button onclick="resetRima()" style="padding:5px 14px;border-radius:7px;background:#e2e2fa;color:#2d1b99;font-weight:600">리마 생성/초기화</button>
    </div>
    <div class="section" id="rimaBoard" style="min-height:100px"></div>
    <form onsubmit="manualCmd();return false;" class="cmdbar">
      <input id="cmd" autocomplete="off" placeholder="리마에게 명령 또는 질문" />
      <button id="sendbtn" type="submit">전송</button>
    </form>
  </div>
  <script>
    let rimaMemory = {
      name: "리마",
      info: {},
      log: []
    };

    // 리마 생성/초기화
    function resetRima() {
      rimaMemory = {name:"리마",info:{},log:[]};
      showMsg(`<b>시스템:</b> 새로운 리마가 생성되었습니다! 이름을 바꾸고 싶으면 "이름을 OOO로 해" 라고 입력하세요.`);
    }

    // 명령 처리
    function rimaResponse(input) {
      input = input.trim();
      let out = [];
      // 이름 바꾸기
      if(/이름.*해/.test(input)) {
        let nm = input.replace(/.*이름.*해/,'').trim();
        if(nm.length>=1) {
          rimaMemory.name = nm;
          out.push(`이제부터 제 이름은 ${nm}입니다!`);
        }
      }
      // 딸기 설명 요청
      else if(input.includes("딸기") && input.includes("설명")) {
        out.push("딸기는 빨간색의 과일로, 비타민C와 항산화 성분이 풍부합니다. 새콤달콤하고 건강에 좋습니다.");
      }
      // 새로운 정보 추가(예: "딸기는 여름과일이야" 등)
      else if(input.match(/.*는.*야/)) {
        let [key, val] = input.split("는");
        if(key && val) {
          rimaMemory.info[key.trim()] = val.replace("야","").trim();
          out.push(`${key.trim()}를 '${val.replace("야","").trim()}'(으)로 기억할게요.`);
        }
      }
      // 내가 질문한 정보가 기억에 있으면 답변
      else if(rimaMemory.info[input]) {
        out.push(rimaMemory.info[input]);
      }
      // 기타
      else {
        out.push("질문을 이해했습니다! 더 자세히 설명하거나, 직접 추가/수정해 주세요.");
      }
      return out;
    }
    function manualCmd() {
      let v = document.getElementById('cmd').value.trim();
      if(!v) return;
      showMsg(`<b>나:</b> ${v}`);
      let replies = rimaResponse(v);
      for(let i=0; i<replies.length; i++) {
        setTimeout(()=>{ showMsg(`<b>${rimaMemory.name}:</b> ${replies[i]}`); }, 500*i+500);
      }
      rimaMemory.log.push({me:v, rima:replies});
      document.getElementById('cmd').value = "";
    }
    function showMsg(msg) {
      let el = document.getElementById('rimaBoard');
      el.innerHTML += `<div class='msg'>${msg}</div>`;
      el.scrollTop = el.scrollHeight;
    }
    // 처음 인사
    showMsg("<b>리마:</b> 안녕하세요! 무엇을 도와드릴까요?");
  </script>
</body>
